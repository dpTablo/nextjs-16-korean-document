# 프로덕션 체크리스트

Next.js 애플리케이션을 프로덕션에 배포하기 전에, 최상의 사용자 경험, 성능 및 보안을 위해 고려해야 할 몇 가지 최적화와 패턴이 있습니다.

이 페이지는 [애플리케이션 빌드](#개발-중) 시 및 [프로덕션 배포 전](#프로덕션-배포-전)에 참조로 사용할 수 있는 모범 사례와 알아야 할 [자동 Next.js 최적화](#자동-최적화)를 제공합니다.

## 자동 최적화

이러한 Next.js 최적화는 기본적으로 활성화되어 있으며 별도의 설정이 필요하지 않습니다:

- **서버 컴포넌트:** Next.js는 기본적으로 서버 컴포넌트를 사용합니다. 서버 컴포넌트는 서버에서 실행되며 클라이언트에서 렌더링하는 데 JavaScript가 필요하지 않습니다. 따라서 클라이언트 측 JavaScript 번들 크기에 영향을 주지 않습니다. 필요에 따라 상호작용을 위해 클라이언트 컴포넌트를 사용할 수 있습니다.

- **코드 분할:** 서버 컴포넌트는 라우트 세그먼트별로 자동 코드 분할을 활성화합니다. 적절한 경우 클라이언트 컴포넌트와 서드파티 라이브러리의 지연 로딩도 고려할 수 있습니다.

- **프리페칭:** 새 라우트에 대한 링크가 사용자의 뷰포트에 들어오면 Next.js가 백그라운드에서 해당 라우트를 프리페치합니다. 이를 통해 새 라우트로의 탐색이 거의 즉시 이루어집니다. 적절한 경우 프리페칭을 비활성화할 수 있습니다.

- **정적 렌더링:** Next.js는 빌드 시 서버에서 서버 및 클라이언트 컴포넌트를 정적으로 렌더링하고 렌더링된 결과를 캐시하여 애플리케이션 성능을 향상시킵니다. 적절한 경우 특정 라우트에 대해 동적 렌더링을 선택할 수 있습니다.

- **캐싱:** Next.js는 데이터 요청, 서버 및 클라이언트 컴포넌트의 렌더링된 결과, 정적 자산 등을 캐시하여 서버, 데이터베이스 및 백엔드 서비스에 대한 네트워크 요청 수를 줄입니다. 적절한 경우 캐싱을 비활성화할 수 있습니다.

이러한 기본값은 애플리케이션의 성능을 향상시키고 각 네트워크 요청에서 전송되는 데이터의 비용과 양을 줄이는 것을 목표로 합니다.

## 개발 중

애플리케이션을 빌드하는 동안 최상의 성능과 사용자 경험을 보장하기 위해 다음 기능을 사용하는 것을 권장합니다:

### 라우팅 및 렌더링

- **레이아웃:** 레이아웃을 사용하여 페이지 간에 UI를 공유하고 탐색 시 부분 렌더링을 활성화합니다.

- **`<Link>` 컴포넌트:** 클라이언트 측 탐색 및 프리페칭을 위해 `<Link>` 컴포넌트를 사용합니다.

- **에러 처리:** 커스텀 에러 페이지를 생성하여 프로덕션에서 포괄적 에러와 404 에러를 우아하게 처리합니다.

- **클라이언트 및 서버 컴포넌트:** 서버 및 클라이언트 컴포넌트에 대한 권장 구성 패턴을 따르고, `"use client"` 경계 배치를 확인하여 클라이언트 측 JavaScript 번들을 불필요하게 증가시키지 않도록 합니다.

- **동적 API:** `cookies` 및 `searchParams` prop과 같은 동적 API는 전체 라우트를 동적 렌더링으로 전환합니다(루트 레이아웃에서 사용하는 경우 전체 애플리케이션). 동적 API 사용이 의도적인지 확인하고 적절한 경우 `<Suspense>` 경계로 감싸세요.

> **알아두면 좋은 점:** 부분 프리렌더링(실험적)을 사용하면 전체 라우트를 동적 렌더링으로 전환하지 않고도 라우트의 일부를 동적으로 만들 수 있습니다.

### 데이터 가져오기 및 캐싱

- **서버 컴포넌트:** 서버 컴포넌트를 사용하여 서버에서 데이터를 가져오는 이점을 활용합니다.

- **라우트 핸들러:** 라우트 핸들러를 사용하여 클라이언트 컴포넌트에서 백엔드 리소스에 액세스합니다. 그러나 추가 서버 요청을 피하기 위해 서버 컴포넌트에서 라우트 핸들러를 호출하지 마세요.

- **스트리밍:** 로딩 UI와 React Suspense를 사용하여 서버에서 클라이언트로 UI를 점진적으로 전송하고, 데이터를 가져오는 동안 전체 라우트가 차단되는 것을 방지합니다.

- **병렬 데이터 가져오기:** 적절한 경우 데이터를 병렬로 가져와 네트워크 워터폴을 줄입니다. 또한 적절한 경우 데이터 미리 로드를 고려합니다.

- **데이터 캐싱:** 데이터 요청이 캐시되고 있는지 확인하고 적절한 경우 캐싱을 활성화합니다. `fetch`를 사용하지 않는 요청도 캐시되도록 합니다.

- **정적 이미지:** `public` 디렉토리를 사용하여 애플리케이션의 정적 자산(예: 이미지)을 자동으로 캐시합니다.

### UI 및 접근성

- **폼 및 유효성 검사:** Server Actions를 사용하여 폼 제출, 서버 측 유효성 검사 및 에러를 처리합니다.

- **글로벌 에러 UI:** `app/global-error.tsx`를 추가하여 앱 전체에서 잡히지 않은 에러에 대해 일관되고 접근 가능한 폴백 UI 및 복구 기능을 제공합니다.

- **글로벌 404:** `app/global-not-found.tsx`를 추가하여 앱 전체에서 일치하지 않는 라우트에 대해 접근 가능한 404를 제공합니다.

- **폰트 모듈:** 폰트 모듈을 사용하여 폰트를 최적화합니다. 이 모듈은 폰트 파일을 다른 정적 자산과 함께 자동으로 호스팅하고, 외부 네트워크 요청을 제거하며, 레이아웃 시프트를 줄입니다.

- **`<Image>` 컴포넌트:** 이미지 컴포넌트를 사용하여 이미지를 최적화합니다. 이 컴포넌트는 이미지를 자동으로 최적화하고, 레이아웃 시프트를 방지하며, WebP와 같은 최신 형식으로 제공합니다.

- **`<Script>` 컴포넌트:** 스크립트 컴포넌트를 사용하여 서드파티 스크립트를 최적화합니다. 이 컴포넌트는 스크립트를 자동으로 지연시키고 메인 스레드를 차단하는 것을 방지합니다.

- **ESLint:** 내장된 `eslint-plugin-jsx-a11y` 플러그인을 사용하여 접근성 문제를 조기에 발견합니다.

### 보안

- **테인팅(Tainting):** 데이터 객체 및/또는 특정 값을 테인트하여 민감한 데이터가 클라이언트에 노출되는 것을 방지합니다.

- **Server Actions:** 사용자가 Server Actions를 호출할 권한이 있는지 확인합니다. 권장 보안 사례를 검토하세요.

- **환경 변수:** `.env.*` 파일이 `.gitignore`에 추가되어 있고 공개 변수만 `NEXT_PUBLIC_` 접두사가 붙어 있는지 확인합니다.

- **콘텐츠 보안 정책:** 크로스 사이트 스크립팅, 클릭재킹 및 기타 코드 주입 공격과 같은 다양한 보안 위협으로부터 애플리케이션을 보호하기 위해 콘텐츠 보안 정책 추가를 고려합니다.

### 메타데이터 및 SEO

- **메타데이터 API:** 메타데이터 API를 사용하여 페이지 제목, 설명 등을 추가하여 애플리케이션의 검색 엔진 최적화(SEO)를 개선합니다.

- **Open Graph (OG) 이미지:** 소셜 공유를 위해 애플리케이션을 준비하기 위해 OG 이미지를 생성합니다.

- **사이트맵 및 robots:** 사이트맵 및 robots 파일을 생성하여 검색 엔진이 페이지를 크롤링하고 인덱싱할 수 있도록 합니다.

### 타입 안전성

- **TypeScript 및 TS 플러그인:** 더 나은 타입 안전성을 위해 TypeScript와 TypeScript 플러그인을 사용하고, 에러를 조기에 발견할 수 있도록 합니다.

## 프로덕션 배포 전

프로덕션에 배포하기 전에 `next build`를 실행하여 로컬에서 애플리케이션을 빌드하고 빌드 에러를 확인한 다음, `next start`를 실행하여 프로덕션과 유사한 환경에서 애플리케이션의 성능을 측정할 수 있습니다.

### Core Web Vitals

- **Lighthouse:** 시크릿 모드에서 lighthouse를 실행하여 사용자가 사이트를 어떻게 경험할지 더 잘 이해하고 개선 영역을 식별합니다. 이것은 시뮬레이션된 테스트이며 필드 데이터(예: Core Web Vitals)를 확인하는 것과 병행해야 합니다.

- **`useReportWebVitals` 훅:** 이 훅을 사용하여 Core Web Vitals 데이터를 분석 도구로 전송합니다.

### 번들 분석

`@next/bundle-analyzer` 플러그인을 사용하여 JavaScript 번들의 크기를 분석하고 애플리케이션 성능에 영향을 줄 수 있는 대형 모듈과 종속성을 식별합니다.

또한 다음 도구들이 애플리케이션에 새 종속성을 추가하는 영향을 이해하는 데 도움이 될 수 있습니다:

- [Import Cost](https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost)
- [Package Phobia](https://packagephobia.com/)
- [Bundle Phobia](https://bundlephobia.com/)
- [bundlejs](https://bundlejs.com/)
